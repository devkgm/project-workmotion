<?xml version="1.0" encoding="UTF-8"?>
		<!DOCTYPE mapper
		    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
		    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
		    
<mapper namespace="com.workmotion.app.hr.HrDAO">
	
		
		<sql id="search">
		 M.name LIKE '%'||#{pager.search}||'%'
		</sql>
		
		
		<!--페이징처리 총 사원수  -->
		<select id="totalCount" resultType="Long" parameterType="Map">
		SELECT COUNT(*) FROM department D 
 		JOIN member M on(D.id=M.department_id) 
		LEFT JOIN position P ON (m.position_id=p.id) 
		WHERE company_id = #{memberDTO.company_id} 
		AND <include refid="search"></include>
		</select>
		
		<!--인사 리스트 -->
		<select id="getMemberList" parameterType="Map" resultType="Map">
		SELECT * FROM
		(SELECT ROWNUM R , ML.* FROM
		(SELECT M.*,P.name PNAME,D.name DNAME FROM department D 
 		JOIN member M on(D.id=M.department_id) 
		LEFT JOIN position P ON (m.position_id=p.id) 
		WHERE company_id = #{memberDTO.company_id} 
		AND <include refid="search"></include>
		ORDER BY position_id ASC)ML)
		WHERE R BETWEEN #{pager.startRow} AND #{pager.lastRow}
		</select>
		
		
		<!--상세 페이지 디테일-->
		<select id="getMemberDetail" parameterType="MemberDTO" resultType="Map">
		SELECT M.*,D.name DNAME,P.name PNAME,A.name ANAME,A.ORI_NAME AORINAME FROM DEPARTMENT D 
		JOIN MEMBER M on(D.id = M.DEPARTMENT_ID)
		JOIN POSITION P ON(M.POSITION_ID=P.id)
		JOIN AVATAR A ON (M.id=A.MEMBER_ID)
		WHERE M.EMAIL  = ${email}
		</select>
		
	
		<!--리스트 조회 디테일-->
		<select id="getListDetail" parameterType="MemberDTO" resultType="MemberDTO">
		SELECT * FROM member M WHERE email = #{email}	
		</select>

	
	
	
	
	
	
	
	
	
	
	
	
	
		





</mapper>