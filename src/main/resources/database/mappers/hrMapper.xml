<?xml version="1.0" encoding="UTF-8"?>
		<!DOCTYPE mapper
		    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
		    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
		    
<mapper namespace="com.workmotion.app.hr.HrDAO">
	
		
		<sql id="search">
		 M.name LIKE '%'||#{pager.search}||'%'
		</sql>
		
		
		
		<select id="totalCount" resultType="Long" parameterType="Map">
		SELECT COUNT(*) FROM department D 
 		JOIN member M on(D.id=M.department_id) 
		LEFT JOIN position P ON (m.position_id=p.id) 
		WHERE company_id = #{memberDTO.company_id} 
		AND <include refid="search"></include>
		</select>
		
		<!--인사 리스트 -->
		<select id="getMemberList" parameterType="Map" resultType="Map">
		SELECT * FROM
		(SELECT ROWNUM R , ML.* FROM
		(SELECT M.*,P.name PNAME,D.name DNAME FROM department D 
 		JOIN member M on(D.id=M.department_id) 
		LEFT JOIN position P ON (m.position_id=p.id) 
		WHERE company_id = #{memberDTO.company_id} 
		AND <include refid="search"></include>
		ORDER BY position_id ASC)ML)
		WHERE R BETWEEN #{pager.startRow} AND #{pager.lastRow}
		</select>
		

	
		<!--디테일-->
		<select id="getMemberDetail" parameterType="MemberDTO" resultMap="getDetailMemberResult">
		SELECT M.*, A.name avatar_name ,A.ori_name FROM member M 
		LEFT JOIN avatar A ON (M.id = A.MEMBER_ID) 
		WHERE email = #{email}	
		</select>
		<resultMap type="MemberDTO" id="getDetailMemberResult">
		<id column="id" property="id"/>
		<result column="rold_id" property="role_id"/>
		<result column="company_id" property="company_id"/>
		<result column="email" property="email"/>
		<result column="password" property="password"/>
		<result column="name" property="name"/>
		<result column="department_id" property="department_id"/>
		<result column="position_id" property="position_id"/>
		<result column="phone" property="phone"/>
		<association property="avatar" javaType="Avatar" >
		<id column="id" property="id"/>
		<result column="avatar_name" property="name"/>
		<result column="ori_name" property="ori_name"/>
		</association>
		</resultMap> 
	
	
	
	
	
	
	
	
	
	
	
	
	
		





</mapper>