<?xml version="1.0" encoding="UTF-8"?>
		<!DOCTYPE mapper
		    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
		    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
		    
<mapper namespace="com.workmotion.app.member.MemberDAO">

		
		
		<!-- 파일 삭제 -->
		<delete id="setFileDelete" parameterType="Avatar" >
		DELETE avatar WHERE name = #{name}
		</delete>
		
		<!--파일추가-->
		<insert id="setFileAdd" parameterType="Avatar">
		INSERT INTO avatar VALUES(AVATAR_SEQ.NEXTVAL,#{member_id},#{name},#{ori_name})
		</insert>
		
		<!--이메일 체크 -->
		<select id="emailCheck" parameterType="MemberDTO" resultType="MemberDTO">
		SELECT email FROM member WHERE email = #{email}
		</select>
		
		<!-- 로그인 조회  -->
		<select id="detailMember" parameterType="MemberDTO" resultMap="getDetailMemberResult">
		SELECT M.*, A.name avatar_name ,P.name PNAME,D.name DNAME FROM member M 
		JOIN avatar A ON (M.id = A.MEMBER_ID) 
		JOIN POSITION P ON(M.POSITION_ID=P.id)
		JOIN DEPARTMENT D on(M.DEPARTMENT_ID=D.ID)
		WHERE email = #{email}
		</select>
		<resultMap type="MemberDTO" id="getDetailMemberResult">
		<id column="id" property="id"/>
		<result column="rold_id" property="role_id"/>
		<result column="company_id" property="company_id"/>
		<result column="email" property="email"/>
		<result column="password" property="password"/>
		<result column="name" property="name"/>
		<result column="department_id" property="department_id"/>
		<result column="position_id" property="position_id"/>
		<result column="phone" property="phone"/>
		<association property="avatar" javaType="Avatar" >
		<id column="id" property="id"/>
		<result column="avatar_name" property="name"/>
		<result column="ori_name" property="ori_name"/>
		</association>
		
		<association property="position" javaType="PositionDTO" >
		<id column="id" property="id"/>
		<result column="PNAME" property="name"/>
		</association>
		
		<association property="department" javaType="DepartmentDTO">
		<id column="id" property="id"/>
		<result column="DNAME" property="name"/>
		</association>
		</resultMap> 
		
		
		<!--회원가입-->
 		<insert id="createMember" parameterType="MemberDTO">

		INSERT INTO member VALUES(member_SEQ.NEXTVAL,0,#{company_id},
		#{email},#{password},#{name},0,10,#{phone})

		</insert>
	
	
	
		<!--마이페이지 수정-->
		<update id="updateMember" parameterType="MemberDTO">
		UPDATE member <set>	
		<if test="email != null and email !=''">
		email = #{email},</if>
		<if test="password != null and password !=''">
		password = #{password},</if>
		<if test="name != null and name !=''">
		name = #{name},</if>
		<if test="phone !=null and phone != ''">
		phone = #{phone}
		</if>
		</set>
		WHERE id = #{id}
		</update>   
	
</mapper>